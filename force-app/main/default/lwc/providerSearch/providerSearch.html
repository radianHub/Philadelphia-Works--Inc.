<template>
	<div class="slds-is-relative">
		<template if:true={isLoading}>
			<lightning-spinner variant="brand" size="large"></lightning-spinner>
		</template>
		<h2
			class="title"
			style={headerStyle}>
			{title}
		</h2>
		<p class="description slds-var-m-bottom_large">{description}</p>
		<lightning-layout
				class="filter-container slds-var-p-around_medium slds-var-m-bottom_medium"
				multiple-rows="true"
				vertical-align="end">
			<lightning-layout-item
					padding="around-small"
					flexibility="auto">
				<lightning-input
						name="zipcode"
						label="Zip"
						type="search"
						onchange={handleInputChange}
				></lightning-input>
			</lightning-layout-item>
			<template for:each={searchFiltersFieldData} for:item="field">
				<template lwc:if={field.isPicklist}>
					<lightning-layout-item
							key={field.apiName}
							padding="around-small"
							flexibility="auto">
						<c-multi-select-combobox
								label={field.label}
								name={field.apiName}
								options={field.options}
								onchange={handleMultiselectChange}
						></c-multi-select-combobox>
					</lightning-layout-item>
				</template>
				<template lwc:else>
					<lightning-layout-item
							key={field.apiName}
							padding="around-small"
							flexibility="auto">
						<lightning-input
								label={field.label}
								name={field.apiName}
								type="search"
								onchange={handleInputChange}
						></lightning-input>
					</lightning-layout-item>
				</template>
			</template>
			<lightning-layout-item
					padding="around-small"
					alignment-bump="left">
				<lightning-button
						label="Clear Filters"
						onclick={handleClear}
				></lightning-button>
			</lightning-layout-item>
		</lightning-layout>

		<template if:true={hasLoaded}>
			<div lwc:if={hasProviders}>
				<c-provider-map providers={mapProviders}></c-provider-map>
			</div>
			<div class="slds-p-around_xx-large slds-text-align_center" lwc:else>
				<h3 class="slds-text-heading_medium slds-m-bottom_small">No Results Found</h3>
				<p class="slds-m-bottom_x-large">No results match the filter criteria. Adjust your filters or clear all filters to show results.</p>
				<lightning-button onclick={handleClear} label="Clear Filters"></lightning-button>
			</div>
		</template>

		<lightning-layout
			class="slds-var-m-bottom_medium"
			horizontal-align="spread"
			pull-to-boundary="small"
			multiple-rows="true">
			<template
				for:each={providers}
				for:item="provider">
				<lightning-layout-item
					size="12"
					padding="around-small"
					small-device-size="12"
					medium-device-size="6"
					large-device-size="4"
					key={provider.id}>
					<c-provider-tile
						job-id={provider.id}
						title={provider.title}
						subtitle={provider.subtitle}
						description={provider.richDescription}
						address={provider.address}
						details={provider.details}
						card-header-color={cardHeaderColor}
						card-body-bg-color={cardBodyBgColor}
						show-apply={showApply}></c-provider-tile>
				</lightning-layout-item>
			</template>
		</lightning-layout>
	</div>
</template>